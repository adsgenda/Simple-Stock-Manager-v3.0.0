import{d as _,W as I,o as e,e as l,a as c,r as Y,b as i,w as s,g as u,t as o,V as M,n as C,s as j,i as z,T as D,j as U,z as W,c as b,u as n,f,F as G,h as O,Q as B,y as L}from"./app-DvcEWBb-.js";import{_ as J}from"./ActionSection-De3yvd1B.js";import{_ as $}from"./Button-CqSGXcNL.js";import{_ as q}from"./Input-CR1qtmG5.js";import{_ as A}from"./InputError-CKMLs-tu.js";import{_ as X}from"./DialogModal-CF240EeB.js";import{_ as F}from"./SecondaryButton-DsJqz4h9.js";import{_ as Z}from"./DangerButton-71d8Iw8G.js";import{_ as ee}from"./Label-Vj9Pqrhi.js";import"./SectionTitle-Dxuf_BKR.js";import"./Modal-B8qV30f2.js";const te={class:"mt-4"},x={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(k,{emit:a}){const T=a,w=_(!1),t=I({password:"",error:"",processing:!1}),r=_(null),v=()=>{axios.get(route("password.confirmation")).then(d=>{d.data.confirmed?T("confirmed"):(w.value=!0,setTimeout(()=>r.value.focus(),250))})},g=()=>{t.processing=!0,axios.post(route("password.confirm"),{password:t.password}).then(()=>{t.processing=!1,h(),j().then(()=>T("confirmed"))}).catch(d=>{t.processing=!1,t.error=d.response.data.errors.password[0],r.value.focus()})},h=()=>{w.value=!1,t.password="",t.error=""};return(d,m)=>(e(),l("span",null,[c("span",{onClick:v},[Y(d.$slots,"default")]),i(X,{show:w.value,onClose:h,"max-width":"sm"},{title:s(()=>[u(o(k.title),1)]),content:s(()=>[u(o(k.content)+" ",1),c("div",te,[i(q,{type:"password",ref_key:"passwordInput",ref:r,placeholder:"Password",modelValue:t.password,"onUpdate:modelValue":m[0]||(m[0]=y=>t.password=y),class:"mt-1 block w-full",onKeyup:M(g,["enter"])},null,8,["modelValue"]),i(A,{message:t.error,class:"mt-2"},null,8,["message"])])]),footer:s(()=>[i(F,{onClick:h},{default:s(()=>m[1]||(m[1]=[u(" Cancel ")])),_:1}),i($,{class:C(["ml-3",{"opacity-25":t.processing}]),disabled:t.processing,onClick:g},{default:s(()=>[u(o(k.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}},oe={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},se={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ae={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ne={class:"mt-3 max-w-xl text-sm"},re={key:3},le={key:0},ie={class:"mt-4 max-w-xl text-sm"},ce={key:0,class:"font-semibold"},ue={key:1},de={class:"mt-4 p-3 rounded-md bg-white inline-flex items-start justify-center"},me=["innerHTML"],fe={key:0,class:"mt-4 max-w-xl text-sm"},pe={class:"font-semibold"},_e=["innerHTML"],ve={key:1,class:"mt-4"},he={key:1},ye={class:"mt-4 max-w-xl text-sm"},we={class:"font-semibold"},ge={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-800 rounded-lg"},be={class:"mt-5"},xe={key:0},ke={key:1},Le={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(k){const{t:a}=z({}),T=k,w=_(""),t=_(!1),r=_(!1),v=_(!1),g=_(null),h=_(null),d=_([]),m=D({code:""}),y=U(()=>{var p;return!t.value&&((p=B().props.user)==null?void 0:p.two_factor_enabled)});W(y,()=>{y.value||(m.reset(),m.clearErrors())});const E=()=>{t.value=!0,L.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([H(),N(),V()]),onFinish:()=>{t.value=!1,r.value=T.requiresConfirmation}})},H=()=>axios.get("/user/two-factor-qr-code").then(p=>{g.value=p.data.svg}),N=()=>axios.get("/user/two-factor-secret-key").then(p=>{h.value=p.data.secretKey}),V=()=>axios.get("/user/two-factor-recovery-codes").then(p=>{d.value=p.data}),P=()=>{if(B().props.demo)return w.value=a("This feature is disabled on demo."),!1;m.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{r.value=!1,g.value=null,h.value=null}})},Q=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>V())},K=()=>{v.value=!0,L.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{v.value=!1,r.value=!1}})};return(p,R)=>(e(),b(J,null,{title:s(()=>[u(o(n(a)("Two Factor Authentication")),1)]),description:s(()=>[u(o(n(a)("Add additional security to your account using two factor authentication.")),1)]),content:s(()=>[y.value&&!r.value?(e(),l("h3",oe,o(n(a)("You have enabled two factor authentication.")),1)):y.value&&r.value?(e(),l("h3",se,o(n(a)("Finish enabling two factor authentication.")),1)):(e(),l("h3",ae,o(n(a)("You have not enabled two factor authentication.")),1)),c("div",ne,[c("p",null,o(n(a)("When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application.")),1)]),y.value?(e(),l("div",re,[g.value?(e(),l("div",le,[c("div",ie,[r.value?(e(),l("p",ce,o(n(a)("To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code.")),1)):(e(),l("p",ue,o(n(a)("Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key.")),1))]),c("div",de,[c("div",{innerHTML:g.value},null,8,me)]),h.value?(e(),l("div",fe,[c("p",pe,[u(o(n(a)("Setup Key"))+": ",1),c("span",{innerHTML:h.value},null,8,_e)])])):f("",!0),r.value?(e(),l("div",ve,[i(ee,{for:"code",value:"Code"}),i(q,{id:"code",autofocus:"",type:"text",name:"code",inputmode:"numeric",class:"block mt-1 w-full",autocomplete:"one-time-code",modelValue:n(m).code,"onUpdate:modelValue":R[0]||(R[0]=S=>n(m).code=S),onKeyup:M(P,["enter"])},null,8,["modelValue"]),i(A,{message:n(m).errors.code,class:"mt-2"},null,8,["message"]),w.value?(e(),b(A,{key:0,message:w.value,class:"mt-2"},null,8,["message"])):f("",!0)])):f("",!0)])):f("",!0),d.value.length>0&&!r.value?(e(),l("div",he,[c("div",ye,[c("p",we,o(n(a)("Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost.")),1)]),c("div",ge,[(e(!0),l(G,null,O(d.value,S=>(e(),l("div",{key:S},o(S),1))),128))])])):f("",!0)])):f("",!0),c("div",be,[y.value?(e(),l("div",ke,[i(x,{onConfirmed:P},{default:s(()=>[r.value?(e(),b($,{key:0,type:"button",class:C(["mr-3",{"opacity-25":t.value}]),disabled:t.value},{default:s(()=>[u(o(n(a)("Confirm")),1)]),_:1},8,["class","disabled"])):f("",!0)]),_:1}),i(x,{onConfirmed:Q},{default:s(()=>[d.value.length>0&&!r.value?(e(),b(F,{key:0,class:"mr-3"},{default:s(()=>[u(o(n(a)("Regenerate Recovery Codes")),1)]),_:1})):f("",!0)]),_:1}),i(x,{onConfirmed:V},{default:s(()=>[d.value.length===0&&!r.value?(e(),b(F,{key:0,class:"mr-3"},{default:s(()=>[u(o(n(a)("Show Recovery Codes")),1)]),_:1})):f("",!0)]),_:1}),i(x,{onConfirmed:K},{default:s(()=>[r.value?(e(),b(F,{key:0,class:C({"opacity-25":v.value}),disabled:v.value},{default:s(()=>[u(o(n(a)("Cancel")),1)]),_:1},8,["class","disabled"])):f("",!0)]),_:1}),i(x,{onConfirmed:K},{default:s(()=>[r.value?f("",!0):(e(),b(Z,{key:0,class:C({"opacity-25":v.value}),disabled:v.value},{default:s(()=>[u(o(n(a)("Disable")),1)]),_:1},8,["class","disabled"]))]),_:1})])):(e(),l("div",xe,[i(x,{onConfirmed:E},{default:s(()=>[i($,{type:"button",class:C({"opacity-25":t.value}),disabled:t.value},{default:s(()=>[u(o(n(a)("Enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Le as default};
